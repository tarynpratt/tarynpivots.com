<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to rotate rows into columns in MySQL - Taryn Pratt</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Taryn" />
  <meta name="description" content="I have answered a lot of MySQL pivot questions over on Stack Overflow and a few over on Database Administrators and have learned some things about how to transform data in MySQL.
Unfortunately, MySQL does not have PIVOT function, so in order to rotate data from rows into columns you will have to use a CASE expression along with an aggregate function.
Let&amp;rsquo;s set up some sample data.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  create table products ( prod_id int not null, prod_name varchar(50) not null, primary key (prod_id) ); insert into products (prod_id, prod\name) values (1, &amp;#39;Shoes&amp;#39;), (2, &amp;#39;Pants&amp;#39;), (3, &amp;#39;Shirt&amp;#39;); create table reps ( rep_id int not null, rep_name varchar(50) not null, primary key (rep_id) ); insert into reps (rep_id, rep_name) values (1, &amp;#39;John&amp;#39;), (2, &amp;#39;Sally&amp;#39;), (3, &amp;#39;Joe&amp;#39;), (4, &amp;#39;Bob&amp;#39;); create table sales ( prod_id INT NOT NULL, rep_id INT NOT NULL, sale_date datetime not null, quantity int not null, PRIMARY KEY (prod_id, rep_id, sale_date), FOREIGN KEY (prod_id) REFERENCES products(prod_id), FOREIGN KEY (rep_id) REFERENCES reps(rep_id) ); insert into sales (prod_id, rep_id, sale_date, quantity) values (1, 1, &amp;#39;2013-05-16&amp;#39;, 20), (1, 1, &amp;#39;2013-06-19&amp;#39;, 2), (2, 1, &amp;#39;2013-07-03&amp;#39;, 5), (3, 1, &amp;#39;2013-08-22&amp;#39;, 27), (3, 2, &amp;#39;2013-06-27&amp;#39;, 500), (3, 2, &amp;#39;2013-01-07&amp;#39;, 150), (1, 2, &amp;#39;2013-05-01&amp;#39;, 89), (2, 2, &amp;#39;2013-02-14&amp;#39;, 23), (1, 3, &amp;#39;2013-01-29&amp;#39;, 19), (3, 3, &amp;#39;2013-03-06&amp;#39;, 13), (2, 3, &amp;#39;2013-04-18&amp;#39;, 1), (2, 3, &amp;#39;2013-08-03&amp;#39;, 78), (2, 3, &amp;#39;2013-07-22&amp;#39;, 69);   We can easily query the rep, sales, and product data by joining the tables:" />

  <meta name="keywords" content="blog, sql, sql server, dba, database administrator, taryn, pivots, bluefeet, onlybluefeet, stack overflow, stackoverflow, code, stack, overflow, github, twitter, pivot" />






<meta name="generator" content="Hugo 0.47" />


<link rel="canonical" href="https://tarynpivots.com/post/how-to-rotate-rows-into-columns-in-mysql/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">



<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="How to rotate rows into columns in MySQL" />
<meta property="og:description" content="I have answered a lot of MySQL pivot questions over on Stack Overflow and a few over on Database Administrators and have learned some things about how to transform data in MySQL.
Unfortunately, MySQL does not have PIVOT function, so in order to rotate data from rows into columns you will have to use a CASE expression along with an aggregate function.
Let&rsquo;s set up some sample data.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  create table products ( prod_id int not null, prod_name varchar(50) not null, primary key (prod_id) ); insert into products (prod_id, prod\name) values (1, &#39;Shoes&#39;), (2, &#39;Pants&#39;), (3, &#39;Shirt&#39;); create table reps ( rep_id int not null, rep_name varchar(50) not null, primary key (rep_id) ); insert into reps (rep_id, rep_name) values (1, &#39;John&#39;), (2, &#39;Sally&#39;), (3, &#39;Joe&#39;), (4, &#39;Bob&#39;); create table sales ( prod_id INT NOT NULL, rep_id INT NOT NULL, sale_date datetime not null, quantity int not null, PRIMARY KEY (prod_id, rep_id, sale_date), FOREIGN KEY (prod_id) REFERENCES products(prod_id), FOREIGN KEY (rep_id) REFERENCES reps(rep_id) ); insert into sales (prod_id, rep_id, sale_date, quantity) values (1, 1, &#39;2013-05-16&#39;, 20), (1, 1, &#39;2013-06-19&#39;, 2), (2, 1, &#39;2013-07-03&#39;, 5), (3, 1, &#39;2013-08-22&#39;, 27), (3, 2, &#39;2013-06-27&#39;, 500), (3, 2, &#39;2013-01-07&#39;, 150), (1, 2, &#39;2013-05-01&#39;, 89), (2, 2, &#39;2013-02-14&#39;, 23), (1, 3, &#39;2013-01-29&#39;, 19), (3, 3, &#39;2013-03-06&#39;, 13), (2, 3, &#39;2013-04-18&#39;, 1), (2, 3, &#39;2013-08-03&#39;, 78), (2, 3, &#39;2013-07-22&#39;, 69);   We can easily query the rep, sales, and product data by joining the tables:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tarynpivots.com/post/how-to-rotate-rows-into-columns-in-mysql/" /><meta property="article:published_time" content="2015-01-18T19:00:38&#43;00:00"/>
<meta property="article:modified_time" content="2015-01-18T19:00:38&#43;00:00"/>
<meta itemprop="name" content="How to rotate rows into columns in MySQL">
<meta itemprop="description" content="I have answered a lot of MySQL pivot questions over on Stack Overflow and a few over on Database Administrators and have learned some things about how to transform data in MySQL.
Unfortunately, MySQL does not have PIVOT function, so in order to rotate data from rows into columns you will have to use a CASE expression along with an aggregate function.
Let&rsquo;s set up some sample data.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  create table products ( prod_id int not null, prod_name varchar(50) not null, primary key (prod_id) ); insert into products (prod_id, prod\name) values (1, &#39;Shoes&#39;), (2, &#39;Pants&#39;), (3, &#39;Shirt&#39;); create table reps ( rep_id int not null, rep_name varchar(50) not null, primary key (rep_id) ); insert into reps (rep_id, rep_name) values (1, &#39;John&#39;), (2, &#39;Sally&#39;), (3, &#39;Joe&#39;), (4, &#39;Bob&#39;); create table sales ( prod_id INT NOT NULL, rep_id INT NOT NULL, sale_date datetime not null, quantity int not null, PRIMARY KEY (prod_id, rep_id, sale_date), FOREIGN KEY (prod_id) REFERENCES products(prod_id), FOREIGN KEY (rep_id) REFERENCES reps(rep_id) ); insert into sales (prod_id, rep_id, sale_date, quantity) values (1, 1, &#39;2013-05-16&#39;, 20), (1, 1, &#39;2013-06-19&#39;, 2), (2, 1, &#39;2013-07-03&#39;, 5), (3, 1, &#39;2013-08-22&#39;, 27), (3, 2, &#39;2013-06-27&#39;, 500), (3, 2, &#39;2013-01-07&#39;, 150), (1, 2, &#39;2013-05-01&#39;, 89), (2, 2, &#39;2013-02-14&#39;, 23), (1, 3, &#39;2013-01-29&#39;, 19), (3, 3, &#39;2013-03-06&#39;, 13), (2, 3, &#39;2013-04-18&#39;, 1), (2, 3, &#39;2013-08-03&#39;, 78), (2, 3, &#39;2013-07-22&#39;, 69);   We can easily query the rep, sales, and product data by joining the tables:">


<meta itemprop="datePublished" content="2015-01-18T19:00:38&#43;00:00" />
<meta itemprop="dateModified" content="2015-01-18T19:00:38&#43;00:00" />
<meta itemprop="wordCount" content="1421">



<meta itemprop="keywords" content="crosstab,data,mysql,pivot,rows-to-columns,SQL,SQL queries,transform," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to rotate rows into columns in MySQL"/>
<meta name="twitter:description" content="I have answered a lot of MySQL pivot questions over on Stack Overflow and a few over on Database Administrators and have learned some things about how to transform data in MySQL.
Unfortunately, MySQL does not have PIVOT function, so in order to rotate data from rows into columns you will have to use a CASE expression along with an aggregate function.
Let&rsquo;s set up some sample data.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  create table products ( prod_id int not null, prod_name varchar(50) not null, primary key (prod_id) ); insert into products (prod_id, prod\name) values (1, &#39;Shoes&#39;), (2, &#39;Pants&#39;), (3, &#39;Shirt&#39;); create table reps ( rep_id int not null, rep_name varchar(50) not null, primary key (rep_id) ); insert into reps (rep_id, rep_name) values (1, &#39;John&#39;), (2, &#39;Sally&#39;), (3, &#39;Joe&#39;), (4, &#39;Bob&#39;); create table sales ( prod_id INT NOT NULL, rep_id INT NOT NULL, sale_date datetime not null, quantity int not null, PRIMARY KEY (prod_id, rep_id, sale_date), FOREIGN KEY (prod_id) REFERENCES products(prod_id), FOREIGN KEY (rep_id) REFERENCES reps(rep_id) ); insert into sales (prod_id, rep_id, sale_date, quantity) values (1, 1, &#39;2013-05-16&#39;, 20), (1, 1, &#39;2013-06-19&#39;, 2), (2, 1, &#39;2013-07-03&#39;, 5), (3, 1, &#39;2013-08-22&#39;, 27), (3, 2, &#39;2013-06-27&#39;, 500), (3, 2, &#39;2013-01-07&#39;, 150), (1, 2, &#39;2013-05-01&#39;, 89), (2, 2, &#39;2013-02-14&#39;, 23), (1, 3, &#39;2013-01-29&#39;, 19), (3, 3, &#39;2013-03-06&#39;, 13), (2, 3, &#39;2013-04-18&#39;, 1), (2, 3, &#39;2013-08-03&#39;, 78), (2, 3, &#39;2013-07-22&#39;, 69);   We can easily query the rep, sales, and product data by joining the tables:"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-124638032-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Taryn Pratt</a>
    
    &mdash;
    <a href="/" class="logo-tagline">
       
         Pivots and other SQL fun
       
     </a>
     
</div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/post/about/">About</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <div class="logo">
    <a href="/" class="logo">
      
        Taryn Pratt
      
    </a>
  </div>

  
  <div class="logo-tagline">
    <a href="/" >
      
        Pivots and other SQL fun
      
    </a>
  </div>
  
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/">Home</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/post/">Archives</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/tags/">Tags</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://tarynpivots.com/post/about/">About</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">How to rotate rows into columns in MySQL</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2015-01-18 </span>
        
        <span class="more-meta"> 1421 words </span>
          <span class="more-meta"> 7 min read </span>

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    
  </div>
</div>

    
    <div class="post-content">
      <p>I have answered a lot of <a href="http://stackoverflow.com/search?tab=newest&amp;q=user%3a426671%20%5bpivot%5d%20is%3aanswer%20%5bmysql%5d">MySQL pivot questions over on Stack Overflow</a> and a few over on <a href="http://dba.stackexchange.com/search?q=user%3A9003+%5Bpivot%5D+is%3Aanswer+%5Bmysql%5D">Database Administrators</a> and have learned some things about how to transform data in MySQL.</p>

<p>Unfortunately, MySQL does not have <code>PIVOT</code> function, so in order to rotate data from rows into columns you will have to use a <code>CASE</code> expression along with an aggregate function.</p>

<p>Let&rsquo;s set up some sample data.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">products</span>
<span class="p">(</span>
  <span class="n">prod_id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">prod_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">prod_id</span><span class="p">)</span>
<span class="p">);</span>  

<span class="k">insert</span> <span class="k">into</span> <span class="n">products</span> <span class="p">(</span><span class="n">prod_id</span><span class="p">,</span> <span class="n">prod</span><span class="err">\</span><span class="n">name</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Shoes&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Pants&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Shirt&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">reps</span>
<span class="p">(</span>
  <span class="n">rep_id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">rep_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">rep_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">reps</span> <span class="p">(</span><span class="n">rep_id</span><span class="p">,</span> <span class="n">rep_name</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Joe&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">sales</span>
<span class="p">(</span>
  <span class="n">prod_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">rep_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">sale_date</span> <span class="n">datetime</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">quantity</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">prod_id</span><span class="p">,</span> <span class="n">rep_id</span><span class="p">,</span> <span class="n">sale_date</span><span class="p">),</span>
  <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">prod_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">products</span><span class="p">(</span><span class="n">prod_id</span><span class="p">),</span>
  <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">rep_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">reps</span><span class="p">(</span><span class="n">rep_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">sales</span> <span class="p">(</span><span class="n">prod_id</span><span class="p">,</span> <span class="n">rep_id</span><span class="p">,</span> <span class="n">sale_date</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
<span class="k">values</span> 
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2013-05-16&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2013-06-19&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2013-07-03&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2013-08-22&#39;</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;2013-06-27&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;2013-01-07&#39;</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;2013-05-01&#39;</span><span class="p">,</span> <span class="mi">89</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;2013-02-14&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;2013-01-29&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;2013-03-06&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;2013-04-18&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;2013-08-03&#39;</span><span class="p">,</span> <span class="mi">78</span><span class="p">),</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;2013-07-22&#39;</span><span class="p">,</span> <span class="mi">69</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>

<p>We can easily query the rep, sales, and product data by joining the tables:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
  <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span><span class="p">,</span>
  <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="p">,</span>
  <span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span>
  <span class="n">s</span><span class="p">.</span><span class="n">quantity</span>
<span class="k">from</span> <span class="n">reps</span> <span class="n">r</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">on</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_id</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">rep_id</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">products</span> <span class="n">p</span>
  <span class="k">on</span> <span class="n">s</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span></code></pre></td></tr></table>
</div>
</div>

<p>This will give us the data in the format:</p>

<table>
<thead>
<tr>
<th>REP_NAME</th>
<th>PROD_NAME</th>
<th>SALE_DATE</th>
<th>QUANTITY</th>
</tr>
</thead>

<tbody>
<tr>
<td>John</td>
<td>Shoes</td>
<td>May, 16 2013 00:00:00+0000</td>
<td>20</td>
</tr>

<tr>
<td>John</td>
<td>Shoes</td>
<td>June, 19 2013 00:00:00+0000</td>
<td>2</td>
</tr>

<tr>
<td>John</td>
<td>Pants</td>
<td>July, 03 2013 00:00:00+0000</td>
<td>5</td>
</tr>

<tr>
<td>John</td>
<td>Shirt</td>
<td>August, 22 2013 00:00:00+0000</td>
<td>27</td>
</tr>
</tbody>
</table>

<p>But what if we want to see the reps in separate rows with the total number of products sold in each column. This is where we need to implement the missing <code>PIVOT</code> function, so we&rsquo;ll use the aggregate function <code>SUM</code> with conditional logic instead.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
  <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span> <span class="o">=</span> <span class="s1">&#39;Shoes&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Shoes</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span> <span class="o">=</span> <span class="s1">&#39;Pants&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Pants</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span> <span class="o">=</span> <span class="s1">&#39;Shirt&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Shirt</span>
<span class="k">from</span> <span class="n">reps</span> <span class="n">r</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">on</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_id</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">rep_id</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">products</span> <span class="n">p</span>
  <span class="k">on</span> <span class="n">s</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>

<p>The conditional logic of the <code>CASE</code> expression works hand in hand with the aggregate function to only get a total of the <code>prod_name</code> that you want in each column. Since we have 3 products, then you&rsquo;d write 3 <code>sum(case...</code> expressions for each column. <a href="http://sqlfiddle.com/#!9/cbad7/12/0">Here is a demo on SQL Fiddle.</a> This query will give a result of:</p>

<table>
<thead>
<tr>
<th>REP_NAME</th>
<th>SHOES</th>
<th>PANTS</th>
<th>SHIRT</th>
</tr>
</thead>

<tbody>
<tr>
<td>Joe</td>
<td>19</td>
<td>148</td>
<td>13</td>
</tr>

<tr>
<td>John</td>
<td>22</td>
<td>5</td>
<td>27</td>
</tr>

<tr>
<td>Sally</td>
<td>89</td>
<td>23</td>
<td>650</td>
</tr>
</tbody>
</table>

<p>This could easily be rewritten to show the reps in each column and the products in the rows.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
  <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">John</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span> <span class="o">=</span> <span class="s1">&#39;Sally&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Sally</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span> <span class="o">=</span> <span class="s1">&#39;Joe&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Joe</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">Bob</span>
<span class="k">from</span> <span class="n">products</span> <span class="n">p</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">on</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">prod_id</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">reps</span> <span class="n">r</span>
  <span class="k">on</span> <span class="n">s</span><span class="p">.</span><span class="n">rep_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_id</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>

<p>And now the data is <a href="http://sqlfiddle.com/#!9/cbad7/16/0">reversed</a>:</p>

<table>
<thead>
<tr>
<th>PROD_NAME</th>
<th>JOHN</th>
<th>SALLY</th>
<th>JOE</th>
<th>BOB</th>
</tr>
</thead>

<tbody>
<tr>
<td>Pants</td>
<td>5</td>
<td>23</td>
<td>148</td>
<td>0</td>
</tr>

<tr>
<td>Shirt</td>
<td>27</td>
<td>650</td>
<td>13</td>
<td>0</td>
</tr>

<tr>
<td>Shoes</td>
<td>22</td>
<td>89</td>
<td>19</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>As you can see this is a fairly straightforward and easy way to convert rows into columns when you have a limited number of values. We only had 3 products and 4 reps, so we didn&rsquo;t have a lot of code to write. Things get a bit more complicated when we have an unknown number of columns to transform. If you aren&rsquo;t going to know the values ahead of time, then you will need to look at using a <a href="http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-prepared-statements.html">prepared statement</a> along with dynamic SQL.</p>

<p>When using a prepared statement, you will write a sql string that will then be executed by the server. I always recommend writing a hard-coded version of a query before attempting to write anything dynamically. This will allow you to get the logic correct before doing it with dynamic SQL.</p>

<p>Let&rsquo;s set up a dynamic query using the data above. You need to report the total quantity of items sold by each rep for each month/year combination. Again, this is easy if you only had a few dates, you would write the query:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
  <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span><span class="o">=</span> <span class="s1">&#39;2013-January&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">January</span><span class="o">`</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span><span class="o">=</span> <span class="s1">&#39;2013-February&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">February</span><span class="o">`</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span><span class="o">=</span> <span class="s1">&#39;2013-March&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">March</span><span class="o">`</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span><span class="o">=</span> <span class="s1">&#39;2013-April&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">April</span><span class="o">`</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span><span class="o">=</span> <span class="s1">&#39;2013-May&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">May</span><span class="o">`</span>
<span class="k">from</span> <span class="n">reps</span> <span class="n">r</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">on</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_id</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">rep_id</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">products</span> <span class="n">p</span>
  <span class="k">on</span> <span class="n">s</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">r</span><span class="p">.</span><span class="n">rep_name</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>

<p>You&rsquo;d get the <a href="http://sqlfiddle.com/#!9/cbad7/20/0">result</a>:</p>

<table>
<thead>
<tr>
<th>REP_NAME</th>
<th>2013-JANUARY</th>
<th>2013-FEBRUARY</th>
<th>2013-MARCH</th>
<th>2013-APRIL</th>
<th>2013-MAY</th>
</tr>
</thead>

<tbody>
<tr>
<td>Joe</td>
<td>19</td>
<td>0</td>
<td>13</td>
<td>1</td>
<td>0</td>
</tr>

<tr>
<td>John</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>20</td>
</tr>

<tr>
<td>Sally</td>
<td>150</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>89</td>
</tr>
</tbody>
</table>

<p>But what happens if you don&rsquo;t know the dates ahead of time, or you want to pass in certain parameters to filter the dates and make the report flexible. This is where dynamic SQL is needed. In order to create the sql string to execute, you&rsquo;ll first need to get a full list of the dates from your <code>sales</code> table. This list will be created by using <a href="http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat"><code>GROUP_CONCAT()</code></a> and <a href="http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_concat"><code>CONCAT()</code></a>.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SET</span> <span class="o">@</span><span class="k">sql</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">SELECT</span>
  <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="k">DISTINCT</span>
    <span class="n">CONCAT</span><span class="p">(</span>
      <span class="s1">&#39;sum(case when Date_format(s.sale_date, &#39;&#39;%Y-%M&#39;&#39;) = &#39;&#39;&#39;</span><span class="p">,</span>
      <span class="n">dt</span><span class="p">,</span>
      <span class="s1">&#39;&#39;&#39; then s.quantity else 0 end) AS `&#39;</span><span class="p">,</span>
      <span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span>
    <span class="p">)</span>
  <span class="p">)</span> <span class="k">INTO</span> <span class="o">@</span><span class="k">sql</span>
<span class="k">from</span>
<span class="p">(</span>
  <span class="k">select</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span>
  <span class="k">from</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">s</span><span class="p">.</span><span class="n">sale_date</span>
<span class="p">)</span> <span class="n">d</span><span class="p">;</span>

<span class="k">select</span> <span class="o">@</span><span class="k">sql</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>

<p>This code creates a full list of all the dates inside of the <code>CASE</code> expression and the aggregate function.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;2013-January&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">AS</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">January</span><span class="o">`</span><span class="p">,</span>
<span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;2013-February&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">AS</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">February</span><span class="o">`</span><span class="p">,</span>
<span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;2013-March&#39;</span> <span class="k">then</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">AS</span> <span class="o">`</span><span class="mi">2013</span><span class="o">-</span><span class="n">March</span><span class="o">`</span><span class="p">,</span>
<span class="p">...</span></code></pre></td></tr></table>
</div>
</div>

<p>Now, your full code using the prepared statement will be:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SET</span> <span class="o">@</span><span class="k">sql</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">SELECT</span>
  <span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="k">DISTINCT</span>
    <span class="n">CONCAT</span><span class="p">(</span>
      <span class="s1">&#39;sum(case when Date_format(s.sale_date, &#39;&#39;%Y-%M&#39;&#39;) = &#39;&#39;&#39;</span><span class="p">,</span>
      <span class="n">dt</span><span class="p">,</span>
      <span class="s1">&#39;&#39;&#39; then s.quantity else 0 end) AS `&#39;</span><span class="p">,</span>
      <span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span>
    <span class="p">)</span>
  <span class="p">)</span> <span class="k">INTO</span> <span class="o">@</span><span class="k">sql</span>
<span class="k">from</span>
<span class="p">(</span>
  <span class="k">select</span> <span class="n">Date_format</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">sale_date</span><span class="p">,</span> <span class="s1">&#39;%Y-%M&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span>
  <span class="k">from</span> <span class="n">sales</span> <span class="n">s</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">s</span><span class="p">.</span><span class="n">sale_date</span>
<span class="p">)</span> <span class="n">d</span><span class="p">;</span>

<span class="k">SET</span> <span class="o">@</span><span class="k">sql</span> 
  <span class="o">=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;SELECT r.rep_name, &#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">sql</span><span class="p">,</span> <span class="s1">&#39; 
</span><span class="s1">            from reps r
</span><span class="s1">            inner join sales s
</span><span class="s1">              on r.rep_id = s.rep_id
</span><span class="s1">            inner join products p
</span><span class="s1">              on s.prod_id = p.prod_id
</span><span class="s1">            group by r.rep_name;&#39;</span><span class="p">);</span>

<span class="k">PREPARE</span> <span class="n">stmt</span> <span class="k">FROM</span> <span class="o">@</span><span class="k">sql</span><span class="p">;</span>
<span class="k">EXECUTE</span> <span class="n">stmt</span><span class="p">;</span>
<span class="k">DEALLOCATE</span> <span class="k">PREPARE</span> <span class="n">stmt</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>

<p>Which gives the <a href="http://sqlfiddle.com/#!2/40aea/20/4">final result</a>:</p>

<table>
<thead>
<tr>
<th>REP_NAME</th>
<th>2013-JANUARY</th>
<th>2013-FEBRUARY</th>
<th>2013-MARCH</th>
<th>2013-APRIL</th>
<th>2013-MAY</th>
<th>2013-JUNE</th>
<th>2013-JULY</th>
<th>2013-AUGUST</th>
</tr>
</thead>

<tbody>
<tr>
<td>Joe</td>
<td>19</td>
<td>0</td>
<td>13</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>69</td>
<td>78</td>
</tr>

<tr>
<td>John</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>20</td>
<td>2</td>
<td>5</td>
<td>27</td>
</tr>

<tr>
<td>Sally</td>
<td>150</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>89</td>
<td>500</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>In a few lines of code you&rsquo;ve got a flexible solution that returns any number of columns.</p>

<p><strong>One note</strong> about <code>GROUP_CONCAT()</code>, MySQL has a default length on a system variable used for concatenation. The system variable is called <a href="http://dev.mysql.com/doc/refman/5.0/en/server-system-variables.html#sysvar_group_concat_max_len"><code>group_concat_max_len</code></a> and the default value is 1024, which means if you have a string that will be longer that 1024, then you will need to alter this variable to allow for a longer string.</p>

<p>These are just a few ways that you can convert rows into columns using MySQL.</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://tarynpivots.com/tags/crosstab/">crosstab</a>
          <a href="https://tarynpivots.com/tags/data/">data</a>
          <a href="https://tarynpivots.com/tags/mysql/">mysql</a>
          <a href="https://tarynpivots.com/tags/pivot/">pivot</a>
          <a href="https://tarynpivots.com/tags/rows-to-columns/">rows-to-columns</a>
          <a href="https://tarynpivots.com/tags/sql/">SQL</a>
          <a href="https://tarynpivots.com/tags/sql-queries/">SQL queries</a>
          <a href="https://tarynpivots.com/tags/transform/">transform</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/sql-saturday-adventures/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">SQL Saturday Adventures</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/did-somebody-say-pivot/">
            <span class="next-text nav-default">Did somebody say pivot?</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'tarynpivots-com';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://stackoverflow.com/users/426671/taryn" rel="me noopener" class="iconfont icon-stack-overflow"
        title="stack-overflow" target="_blank">
      </a>
      <a href="https://twitter.com/tarynpivots" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="https://github.com/tarynpratt" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
  <a href="https://tarynpivots.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2013 -
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">
        Taryn
        
      </span></span>

  
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  








</body>
</html>
